extends ../../layout

block head
    link(rel='stylesheet', href='../../css/storeIndex.css')
    link(rel='stylesheet', href='../../css/store.css')
    script(src='../../../js/city/threeCity.js')
    script(src='../../../js/city/cache_city.js')
    script(src='../../../js/tab.js')
block content
    include ../../include/header
    .container
            .content
                include ../../lSide
                .mainInclude
                    .m-content.clearfix
                        .page-title
                            span  我的门店
                            i.arrow &gt;
                            span.last  查看门店详情
                        .main-container
                            .pagecont
                                .mode-main
                                    form(action="/api/publishDsform",enctype='multipart/form-data',method='post',id='mdform')
                                        -var mdtips = Mddetail.pageList[0]
                                        .mc.tab-confirm.tabcheck
                                            .mctablink.tab-hitle
                                                ul
                                                    li 门店基本信息
                                                    li 门店封面信息
                                                    li 门店营业信息
                                                    li 门店收款二维码
                                            .tab-panel
                                                .tab-item
                                                    .publishbox.viewbox
                                                        .item
                                                            .title
                                                                span.name 门店名称：
                                                            .inner
                                                                input.textcheck(type="text",name="eshopname",placeholder='请输入门店名称',data-name="门店名称",value="")
                                                                .word #{mdtips.shopname}
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 门店地址：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入门店地址',data-name="门店地址",value="")
                                                                .word #{mdtips.address}
                                                        .item
                                                            .title
                                                                span.name 门店联系电话：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入门店联系电话',data-name="门店联系电话",value="")
                                                                .word #{mdtips.tel}
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 门店店长：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入门店店长',data-name="门店店长",value="")
                                                                .word #{mdtips.mgrname}
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 门店标签：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入门店店长',data-name="门店店长",value="")
                                                                .word #{shopstylename}
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 门店实景图：
                                                            .inner
                                                                .imgviewcontent.clearfix
                                                                    .imgview
                                                                        img(src=imgUrl+mdtips.shopphotos)
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 门店简介：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入门店简介',data-name="门店简介",value="")
                                                                .word #{mdtips.brand}
                                                            .tips
                                                .tab-item
                                                    .publishbox.viewbox
                                                        .item
                                                            .title
                                                                span.name 门店封面图：
                                                            .inner
                                                                .imgviewcontent.clearfix
                                                                    .imgview
                                                                        img(src=imgUrl + mdtips.shopphotos)
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 门店简称：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入门店简称',data-name="门店简称",value="")
                                                                .word #{mdtips.shopname}
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 所在区域：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入门店简称',data-name="门店简称",value="")
                                                                .word #{mdtips.areas}
                                                            .tips
                                                .tab-item
                                                    .publishbox.viewbox
                                                        .item
                                                            .title
                                                                span.name 营业执照编号：
                                                            .inner
                                                                input.textcheck(type="text",name="eip",placeholder='请输入营业执照编号',data-name="营业执照编号",value="")
                                                                .word #{mdtips.licensenumber}
                                                            .tips
                                                        .item
                                                            .title
                                                                span.name 营业执照扫描件：
                                                            .inner
                                                                .imgviewcontent.clearfix
                                                                    .imgview
                                                                        img(src=imgurl + mdtips.licensephotos)
                                                            .tips
                                                .tab-item
                                                    .publishbox.viewbox
                                                        .item
                                                            .title
                                                                span.name 营业执照扫描件：
                                                            .inner
                                                                .wem
                                                                    -var  data = ewm.pageList[0]
                                                                    img(src=imgUrl+data.qrcodeRec)
                                                            .tips


    script.
        var districts = {
            s1: 'select[name=province]',
            s2: 'select[name=city]',
            s3: 'select[name=district]',
            v1: '110000000000'
        };
        threeSelect(districts);
        $('.item .textcheck').focus(function () {
            $(this).closest('.item').addClass('blur');
        });
        $('.item .textcheck').blur(function () {
            $(this).closest('.item').removeClass('blur');
            var p = $(this).parent().next().get(0);
            var a = $(this).attr('data-name');
            var b = $(this).val();
            if (b === '') {
                $(p).text(a + '不能为空').show();
                $(this).closest('.item').addClass('error');
            } else {
                $(p).text('').hide();
                $(this).closest('.item').removeClass('error');
            }
        });
        $('.item .textcheck').bind('input propertychange', function () {
            $($(this).parent().next().get(0)).hide().html();
            $(this).closest('.item').removeClass('error');
            $('.loginTips').removeClass('visiable')
        });

            function change(val) {
                var file = document.getElementById(val.id),
                    pic = document.getElementById('img_'+val.id);

                //var ext = file.value.substring(file.value.lastIndexOf(".") + 1).toLowerCase();
                // gif在IE浏览器暂时无法显示
                //if (ext != 'png' && ext != 'jpg' && ext != 'jpeg') {
                //    zeroModal.alert("图片的格式必须为png或者jpg或者jpeg格式！");
                //    return;
               // }
                var isIE = navigator.userAgent.match(/MSIE/) != null,
                    isIE6 = navigator.userAgent.match(/MSIE 6.0/) != null;
                if (isIE) {
                    file.select();
                    var reallocalpath = document.selection.createRange().text;
                    // IE6浏览器设置img的src为本地路径可以直接显示图片
                    if (isIE6) {
                        pic.src = reallocalpath;
                    } else {
                        // 非IE6版本的IE由于安全问题直接设置img的src无法显示本地图片，但是可以通过滤镜来实现
                        pic.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='image',src=\"" + reallocalpath + "\")";
                        // 设置img的src为base64编码的透明图片 取消显示浏览器默认图片
                        pic.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';
                    }
                } else {
                    html5Reader(file);
                }

                function html5Reader(file) {
                    var files = file.files[0];
                    var id = file.id;
                    var reader = new FileReader();
                    reader.readAsDataURL(files);
                    reader.onload = function (e) {
                        var pic = document.getElementById('img_'+id);
                        pic.src = this.result;
                    }
                }
            }
        $('#tj').click(function () {
            $(".item .textcheck").trigger("blur");
            var picTrue;
            $('.picbox img').each(function () {
                if($(this).attr('src')!==''){
                    picTrue = true;
                    $(this).closest('.picbox').removeClass('error');
                    $(this).closest('.item').find('tips').hide()
                }else{
                    picTrue = false;
                }
            })
            var hdw = $('.tips:visible').length;
            //var picUrl = $('.picbox').find('img').attr('url');
            if(hdw){
                zeroModal.error('请补全所有必填项后再次提交')
            }else if(!picTrue){
                zeroModal.error('请上传电商相关图片后再次提交');
                $('.picbox img').each(function () {
                    if ($(this).attr('src')== '') {
                        $(this).closest('.picbox').addClass('error');
                        $(this).closest('.item').find('.tips').show();
                    }
                })
            }else{
                $('#mdform').submit();
                zeroModal.loading();
            }
        })


